var beejdnd=(function(){var dragInfo={element:null,offset:{x:0,y:0},parentOffset:null,zindex:"",limited:false,limit:{x0:0,y0:0,x1:0,y1:0},width:0,height:0,};function dragstart(e){var position;var draggableParent;var mxInParent,myInParent;var pageCoords={};getPageCoords(e,pageCoords);dragInfo.element=e.target;dragInfo.parentOffset=$(dragInfo.element).parent().offset();mxInParent=pageCoords.pageX-dragInfo.parentOffset.left;myInParent=pageCoords.pageY-dragInfo.parentOffset.top;position=$(dragInfo.element).position();dragInfo.offset.x=mxInParent-position.left;dragInfo.offset.y=myInParent-position.top;dragInfo.zindex=$(dragInfo.element).css("z-index");$(dragInfo.element).css("z-index","999999");dragInfo.width=$(dragInfo.element).width();dragInfo.height=$(dragInfo.element).height();if($(dragInfo.element).hasClass("stayinparent")){dragInfo.limited=true;dragInfo.limit.x0=0;dragInfo.limit.y0=0;dragInfo.limit.x1=$(dragInfo.element).parent().width()-dragInfo.width-1;dragInfo.limit.y1=$(dragInfo.element).parent().height()-dragInfo.height-1;}else{dragInfo.limited=false;}return false;}function drag(e){var mxInParent,myInParent;var nx,ny;if(dragInfo.element){var pageCoords={};getPageCoords(e,pageCoords);mxInParent=pageCoords.pageX-dragInfo.parentOffset.left;myInParent=pageCoords.pageY-dragInfo.parentOffset.top;x=mxInParent-dragInfo.offset.x;y=myInParent-dragInfo.offset.y;if(dragInfo.limited){x=Math.max(x,dragInfo.limit.x0);x=Math.min(x,dragInfo.limit.x1);y=Math.max(y,dragInfo.limit.y0);y=Math.min(y,dragInfo.limit.y1);}$(dragInfo.element).css({left:x+"px",top:y+"px"});return false;}}function drop(e){var x,y,offset;if(dragInfo.element){var pageCoords={};getPageCoords(e,pageCoords);$(dragInfo.element).css("z-index",dragInfo.zindex);$(".droptarget").each(function(index,Element){offset=$(Element).offset();x=pageCoords.pageX-offset.left;y=pageCoords.pageY-offset.top;if(x>0&&y>0&&x<$(Element).width()&&y<$(Element).height()){$(Element).trigger("drop",[dragInfo.element]);}});dragInfo.element=null;return false;}}function getPageCoords(ev,result){var first;if(ev.originalEvent.changedTouches!=undefined){first=ev.originalEvent.changedTouches[0];result.pageX=first.pageX;result.pageY=first.pageY;}else{result.pageX=ev.pageX;result.pageY=ev.pageY;}}function init(){dragInfo.element=null;$(".draggable").bind("mousedown",dragstart);$(".draggable").bind("touchstart",dragstart);$(document).bind("mousemove",drag);$(document).bind("touchmove",drag);$(document).bind("mouseup",drop);$(document).bind("touchend",drop);}function shutdown(){$(".draggable").unbind("mousedown",dragstart);$(".draggable").unbind("touchstart",dragstart);$(document).unbind("mousemove",drag);$(document).unbind("touchmove",drag);$(document).unbind("mouseup",drop);$(document).unbind("touchend",drop);}return{init:init,shutdown:shutdown,};})();